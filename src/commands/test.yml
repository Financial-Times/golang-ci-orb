description: Runs unit and integration tests
parameters:
  coverage-report-folder:
    type: string
    default: "/tmp/coverage-results"
steps:
  - run:
      name: Create test folders
      command: |
        mkdir -p <<parameters.coverage-report-folder>>
  - run:
      name: Run unit and integration tests
      environment:
        COVERAGE_REPORT_FOLDER: <<parameters.coverage-report-folder>>
      command: <<include(scripts/go-test.sh)>>
  - run:
      name: Install GitHub CLI
      command: <<include(scripts/install-gh-cli.sh)>>
  - run:
      name: Send coverage details to Github
      environment:
        COVERAGE_REPORT_FOLDER: <<parameters.coverage-report-folder>>
      command: <<include(scripts/send-coverage-to-github.sh)>>
